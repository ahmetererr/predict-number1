{"ast":null,"code":"var _jsxFileName = \"/Users/ahmet/predict-number1/web/src/components/DrawingCanvas.tsx\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DrawingCanvas = ({\n  mode,\n  onPrediction,\n  requestedDigit\n}) => {\n  _s();\n  const canvasRef = useRef(null);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [context, setContext] = useState(null);\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const ctx = canvas.getContext('2d');\n      if (ctx) {\n        ctx.strokeStyle = 'white';\n        ctx.lineWidth = 10;\n        ctx.lineCap = 'round';\n        ctx.lineJoin = 'round';\n        setContext(ctx);\n      }\n    }\n  }, []);\n  const startDrawing = e => {\n    setIsDrawing(true);\n    const {\n      offsetX,\n      offsetY\n    } = getCoordinates(e);\n    context === null || context === void 0 ? void 0 : context.beginPath();\n    context === null || context === void 0 ? void 0 : context.moveTo(offsetX, offsetY);\n  };\n  const draw = e => {\n    if (!isDrawing) return;\n    const {\n      offsetX,\n      offsetY\n    } = getCoordinates(e);\n    context === null || context === void 0 ? void 0 : context.lineTo(offsetX, offsetY);\n    context === null || context === void 0 ? void 0 : context.stroke();\n  };\n  const stopDrawing = () => {\n    setIsDrawing(false);\n  };\n  const getCoordinates = e => {\n    if ('touches' in e) {\n      var _canvasRef$current;\n      const rect = (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.getBoundingClientRect();\n      return {\n        offsetX: e.touches[0].clientX - ((rect === null || rect === void 0 ? void 0 : rect.left) || 0),\n        offsetY: e.touches[0].clientY - ((rect === null || rect === void 0 ? void 0 : rect.top) || 0)\n      };\n    }\n    return {\n      offsetX: e.nativeEvent.offsetX,\n      offsetY: e.nativeEvent.offsetY\n    };\n  };\n  const clearCanvas = () => {\n    if (context && canvasRef.current) {\n      context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n  };\n  const handleSubmit = async () => {\n    if (!canvasRef.current) return;\n    try {\n      const imageData = canvasRef.current.toDataURL('image/png');\n      console.log('Image data generated:', imageData.substring(0, 50) + '...');\n      const blob = await (await fetch(imageData)).blob();\n      console.log('Blob created:', blob.size, 'bytes');\n      const formData = new FormData();\n      formData.append('image', blob, 'digit.png');\n      if (mode === 'train' && requestedDigit !== null) {\n        formData.append('digit', requestedDigit.toString());\n        console.log('Training mode with digit:', requestedDigit);\n      }\n      const endpoint = mode === 'test' ? '/predict' : '/train';\n      console.log('Sending request to:', `http://localhost:8000${endpoint}`);\n      const response = await axios.post(`http://localhost:8000${endpoint}`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n          'Accept': 'application/json'\n        },\n        withCredentials: false\n      });\n      console.log('Response received:', response.data);\n      if (mode === 'test') {\n        onPrediction(response.data.predicted_digit, response.data.confidence);\n      } else {\n        clearCanvas();\n      }\n    } catch (error) {\n      console.error('Detailed error in handleSubmit:', error);\n      if (axios.isAxiosError(error)) {\n        var _error$response, _error$response2, _error$response3;\n        console.error('Axios error details:', {\n          response: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data,\n          status: (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status,\n          headers: (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.headers\n        });\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col items-center gap-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      width: 280,\n      height: 280,\n      className: \"border-2 border-gray-300 dark:border-gray-600 bg-black rounded-lg touch-none\",\n      onMouseDown: startDrawing,\n      onMouseMove: draw,\n      onMouseUp: stopDrawing,\n      onMouseLeave: stopDrawing,\n      onTouchStart: startDrawing,\n      onTouchMove: draw,\n      onTouchEnd: stopDrawing\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex gap-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: clearCanvas,\n        className: \"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded\",\n        children: \"Clear\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSubmit,\n        className: \"px-4 py-2 bg-blue-600 text-white rounded\",\n        children: mode === 'train' ? 'Submit Training' : 'Test Prediction'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 120,\n    columnNumber: 5\n  }, this);\n};\n_s(DrawingCanvas, \"KTUhFOgO2vZq198L7OfYQwJ83Sc=\");\n_c = DrawingCanvas;\nexport default DrawingCanvas;\nvar _c;\n$RefreshReg$(_c, \"DrawingCanvas\");","map":{"version":3,"names":["React","useRef","useEffect","useState","axios","jsxDEV","_jsxDEV","DrawingCanvas","mode","onPrediction","requestedDigit","_s","canvasRef","isDrawing","setIsDrawing","context","setContext","canvas","current","ctx","getContext","strokeStyle","lineWidth","lineCap","lineJoin","startDrawing","e","offsetX","offsetY","getCoordinates","beginPath","moveTo","draw","lineTo","stroke","stopDrawing","_canvasRef$current","rect","getBoundingClientRect","touches","clientX","left","clientY","top","nativeEvent","clearCanvas","clearRect","width","height","handleSubmit","imageData","toDataURL","console","log","substring","blob","fetch","size","formData","FormData","append","toString","endpoint","response","post","headers","withCredentials","data","predicted_digit","confidence","error","isAxiosError","_error$response","_error$response2","_error$response3","status","className","children","ref","onMouseDown","onMouseMove","onMouseUp","onMouseLeave","onTouchStart","onTouchMove","onTouchEnd","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","$RefreshReg$"],"sources":["/Users/ahmet/predict-number1/web/src/components/DrawingCanvas.tsx"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\nimport axios from 'axios';\n\ninterface DrawingCanvasProps {\n  mode: 'train' | 'test';\n  onPrediction: (digit: number, confidence: number) => void;\n  requestedDigit: number | null;\n}\n\nconst DrawingCanvas: React.FC<DrawingCanvasProps> = ({\n  mode,\n  onPrediction,\n  requestedDigit,\n}) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [context, setContext] = useState<CanvasRenderingContext2D | null>(null);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const ctx = canvas.getContext('2d');\n      if (ctx) {\n        ctx.strokeStyle = 'white';\n        ctx.lineWidth = 10;\n        ctx.lineCap = 'round';\n        ctx.lineJoin = 'round';\n        setContext(ctx);\n      }\n    }\n  }, []);\n\n  const startDrawing = (e: React.MouseEvent<HTMLCanvasElement> | React.TouchEvent<HTMLCanvasElement>) => {\n    setIsDrawing(true);\n    const { offsetX, offsetY } = getCoordinates(e);\n    context?.beginPath();\n    context?.moveTo(offsetX, offsetY);\n  };\n\n  const draw = (e: React.MouseEvent<HTMLCanvasElement> | React.TouchEvent<HTMLCanvasElement>) => {\n    if (!isDrawing) return;\n    const { offsetX, offsetY } = getCoordinates(e);\n    context?.lineTo(offsetX, offsetY);\n    context?.stroke();\n  };\n\n  const stopDrawing = () => {\n    setIsDrawing(false);\n  };\n\n  const getCoordinates = (e: React.MouseEvent<HTMLCanvasElement> | React.TouchEvent<HTMLCanvasElement>) => {\n    if ('touches' in e) {\n      const rect = canvasRef.current?.getBoundingClientRect();\n      return {\n        offsetX: e.touches[0].clientX - (rect?.left || 0),\n        offsetY: e.touches[0].clientY - (rect?.top || 0),\n      };\n    }\n    return {\n      offsetX: e.nativeEvent.offsetX,\n      offsetY: e.nativeEvent.offsetY,\n    };\n  };\n\n  const clearCanvas = () => {\n    if (context && canvasRef.current) {\n      context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n  };\n\n  const handleSubmit = async () => {\n    if (!canvasRef.current) return;\n\n    try {\n      const imageData = canvasRef.current.toDataURL('image/png');\n      console.log('Image data generated:', imageData.substring(0, 50) + '...');\n      \n      const blob = await (await fetch(imageData)).blob();\n      console.log('Blob created:', blob.size, 'bytes');\n      \n      const formData = new FormData();\n      formData.append('image', blob, 'digit.png');\n      \n      if (mode === 'train' && requestedDigit !== null) {\n        formData.append('digit', requestedDigit.toString());\n        console.log('Training mode with digit:', requestedDigit);\n      }\n\n      const endpoint = mode === 'test' ? '/predict' : '/train';\n      console.log('Sending request to:', `http://localhost:8000${endpoint}`);\n\n      const response = await axios.post(`http://localhost:8000${endpoint}`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n          'Accept': 'application/json',\n        },\n        withCredentials: false,\n      });\n\n      console.log('Response received:', response.data);\n\n      if (mode === 'test') {\n        onPrediction(response.data.predicted_digit, response.data.confidence);\n      } else {\n        clearCanvas();\n      }\n    } catch (error) {\n      console.error('Detailed error in handleSubmit:', error);\n      if (axios.isAxiosError(error)) {\n        console.error('Axios error details:', {\n          response: error.response?.data,\n          status: error.response?.status,\n          headers: error.response?.headers\n        });\n      }\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col items-center gap-4\">\n      <canvas\n        ref={canvasRef}\n        width={280}\n        height={280}\n        className=\"border-2 border-gray-300 dark:border-gray-600 bg-black rounded-lg touch-none\"\n        onMouseDown={startDrawing}\n        onMouseMove={draw}\n        onMouseUp={stopDrawing}\n        onMouseLeave={stopDrawing}\n        onTouchStart={startDrawing}\n        onTouchMove={draw}\n        onTouchEnd={stopDrawing}\n      />\n      <div className=\"flex gap-4\">\n        <button\n          onClick={clearCanvas}\n          className=\"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded\"\n        >\n          Clear\n        </button>\n        <button\n          onClick={handleSubmit}\n          className=\"px-4 py-2 bg-blue-600 text-white rounded\"\n        >\n          {mode === 'train' ? 'Submit Training' : 'Test Prediction'}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default DrawingCanvas; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}